<div class="page">
  <div class="lobby">
    <h2>Timeline — Lobby</h2>

    <div class="controls controls--center">
      <div class="stack">
        <button type="button" (click)="createRoom()">Crear sala</button>

        <input
          [(ngModel)]="roomId"
          placeholder="ID de sala"
          inputmode="text"
          autocomplete="off"
          spellcheck="false"
          aria-label="ID de sala"
        />

        <button type="button" (click)="joinRoom()">Unirme a la sala</button>

        <button
          type="button"
          (click)="startGame()"
          [disabled]="!store.snapshot || store.snapshot.phase !== 'LOBBY'"
        >
          Iniciar juego
        </button>

        <button
          type="button"
          (click)="copyRoomCode()"
          [disabled]="!(store.snapshot?.roomId || roomId)"
        >
          Copiar código
        </button>

        <button type="button" class="help" (click)="openTutorial()">¿Cómo se juega?</button>
      </div>
    </div>

    <div *ngIf="store.snapshot as s" class="info">
      <p>
        <b>Sala:</b> {{ s.roomId }}
        &nbsp;|&nbsp;
        <b>Fase:</b> {{ s.phase }}
      </p>

      <h3>Jugadores ({{ s.players.length }}/4)</h3>
      <ul>
        <li *ngFor="let p of s.players">{{ p.name || p.userId }}</li>
      </ul>
    </div>
  </div>
</div>

<div
  class="modal"
  *ngIf="showRules"
  role="dialog"
  aria-modal="true"
  aria-labelledby="howto-title"
  (click)="showRules=false"
>
  <div class="box" (click)="$event.stopPropagation()">
    <h3 id="howto-title">¿Cómo se juega Timeline?</h3>

    <ng-container [ngSwitch]="step">
      <div *ngSwitchCase="0">
        <p><b>1/3</b> Cada jugador recibe 2–3 cartas. La línea de tiempo inicia con una carta semilla que sí muestra el año.</p>
      </div>
      <div *ngSwitchCase="1">
        <p><b>2/3</b> En tu turno, elige la <b>posición</b> (0, 1, 2, …) donde crees que va tu carta.</p>
      </div>
      <div *ngSwitchCase="2">
        <p><b>3/3</b> <i>Regla clásica:</i> si aciertas, la carta queda; si fallas, va al descarte. En ambos casos robas carta (si hay mazo). Gana quien se queda sin cartas o, si acaba el tiempo, quien tenga menos.</p>
      </div>
    </ng-container>

    <div class="nav">
      <button type="button" (click)="prevStep()" [disabled]="step === 0">Atrás</button>
      <button type="button" (click)="nextStep()">
        {{ step < 2 ? 'Siguiente' : '¡Entendido!' }}
      </button>
    </div>
  </div>
</div>

<div *ngIf="toast" class="toast">{{ toast }}</div>
